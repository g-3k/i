<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escanear QR - StefiApp</title>
  <link rel="stylesheet" href="global.css">
</head>
<body>
  <div class="qr-container">
    <h1>Escanear QR</h1>
    <video id="video" autoplay></video>
    <canvas id="canvas" hidden></canvas>
    <p id="output">Esperando escaneo...</p>
    <button id="toggleCam">Cambiar cámara</button>
  </div>

  <script type="module">
    import QrScanner from "https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js";

    const video = document.getElementById("video");
    const output = document.getElementById("output");
    const toggleCam = document.getElementById("toggleCam");

    let scanner;
    let useBackCamera = true;

    async function startScanner() {
      if (scanner) {
        scanner.destroy();
        video.srcObject?.getTracks().forEach(t => t.stop());
      }

      const facingMode = useBackCamera ? "environment" : "user";
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode }
        });
        video.srcObject = stream;

        scanner = new QrScanner(video, result => {
          output.textContent = `Código QR: ${result}`;
          // Aquí podrías hacer un fetch o redirigir automáticamente si es un enlace
        }, {
          highlightScanRegion: true
        });

        scanner.start();
      } catch (err) {
        output.textContent = `Error al acceder a la cámara: ${err.message}`;
      }
    }

    toggleCam.addEventListener("click", () => {
      useBackCamera = !useBackCamera;
      startScanner();
    });

    startScanner();
  </script>
</body>
</html>
